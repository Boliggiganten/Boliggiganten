<!doctype html><html lang="no"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DreamHouse — Meshy v2 (GitHub ready)</title>
<style>body{font-family:Inter,system-ui,Arial;margin:0;background:#f6f7fb;color:#0f172a}header{background:linear-gradient(90deg,#6d28d9,#06b6d4);color:#fff;padding:18px}.wrap{max-width:1100px;margin:0 auto;display:flex;align-items:center}</style>
</head><body><header><div class="wrap"><h1 style="margin:0">DreamHouse — Meshy v2</h1></div></header>
<main style="max-width:1100px;margin:18px auto;padding:16px">
<div id="dropWarning" style="display:none;background:#fee2e2;padding:12px;border-radius:8px;margin-bottom:12px">FEIL OPPLOAD: Det ser ut som du lastet opp via Netlify Drop (funksjoner deaktivert). Bruk Add new project → Deploy manually → Upload deploy eller bruk Git import.</div>
<div style="background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06)">
<h2>Design huset ditt med KI</h2>
<textarea id="desc" rows="3" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef">Moderne trehus, 2 etasjer, store vinduer og takterrasse</textarea>
<div style="display:flex;gap:8px;margin-top:8px"><input id="materials" value="tre, glass, betong" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6e9ef"/><input id="size" value="120" style="width:100px;padding:10px;border-radius:8px;border:1px solid #e6e9ef"/></div>
<div style="margin-top:10px"><button id="genBtn" style="background:#0f172a;color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer">Generer 3D-modell (Meshy)</button><span id="status" style="margin-left:12px;color:#6b7280">idle</span></div>
</div>
<div style="background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.04);margin-top:12px"><h3>3D-resultat</h3><div id="viewer" style="height:260px;border:2px dashed #e6e9ef;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fff">Ingen modell ennå</div><pre id="result" style="background:#f8fafc;padding:12px;border-radius:8px">Ingen resultater ennå.</pre></div>
<script>
async function checkPing(){ try{ const r = await fetch('/.netlify/functions/ping'); if(!r.ok) throw 0; const j = await r.json(); return j && j.ok; }catch(e){return false;} }
(async()=>{ if(!await checkPing()){ document.getElementById('dropWarning').style.display='block'; } })();
const postJSON=async(u,o)=>{ const r=await fetch(u,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(o)}); return r.json(); };
document.getElementById('genBtn').addEventListener('click',async ()=>{ document.getElementById('status').textContent='creating...'; const desc=document.getElementById('desc').value; const materials=document.getElementById('materials').value.split(',').map(s=>s.trim()).filter(Boolean); const size=Number(document.getElementById('size').value)||120; try{ const create = await postJSON('/.netlify/functions/meshyCreateTask',{description:desc,materials,footprint_m2:size,floors:1,mode:'preview'}); document.getElementById('result').textContent=JSON.stringify(create,null,2); if(create.taskId){ document.getElementById('status').textContent='polling...'; const id=create.taskId; const i=setInterval(async ()=>{ const res=await fetch('/.netlify/functions/meshyGetTask?id='+encodeURIComponent(id)); const j=await res.json(); document.getElementById('result').textContent=JSON.stringify(j,null,2); const t=j.task||{}; if(t.status==='succeeded'||t.status==='finished'||t.result){ clearInterval(i); document.getElementById('status').textContent='done'; const modelUrl=t.result?.model_url||t.result?.modelUrl||null; if(modelUrl) document.getElementById('viewer').innerHTML='<a href="'+modelUrl+'" target="_blank">Åpne 3D-modell</a>'; } else { document.getElementById('status').textContent=t.status||'pending'; } },3000); } else { document.getElementById('status').textContent='failed_create'; } }catch(e){ document.getElementById('result').textContent='Feil: '+e; document.getElementById('status').textContent='error'; } });
</script></main></body></html>
